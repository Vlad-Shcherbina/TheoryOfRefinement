\documentclass{article}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}

\begin{document}

\newcommand{\refines}{\sqsubseteq}
\newcommand{\refinedby}{\sqsupseteq}
\newcommand{\eps}{\varepsilon}

% pretty arrows
%\newcommand{\plotkin}[3]{#1\stackrel{#2}{\rightarrow}#3}
%\newcommand{\milner}[3]{#1\stackrel{#2}{\leadsto}#3}

% ugly arrows
\newcommand{\plotkin}[3]{\left< #1, #2 \right> \rightarrow #3}
\newcommand{\milner}[3]{#1-#2\rightarrow #3}


\newtheorem{axiom}{Axiom}
\newtheorem{law}{Law}
\newtheorem{rul}{Rule}  % because 'rule' is already occupied
\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}

Laws and rules are mere shortcuts for some statements.
Only theorems are supposed to be proven (and they typically state that
some rule implies some law or vice versa).


\begin{axiom} [$\refines$ is partial order]
\end{axiom}

\begin{axiom} [Monotonicity of $;$]
\end{axiom}


\begin{definition} [Hoare triple]
$\{p\}q\{r\}$ means $p;q \refines r$
\end{definition}

\begin{definition} [Plotkin reduction]
$\plotkin{p}{q}{r}$ means $p; q \refinedby r$
\end{definition}

\begin{definition} [Milner transition]
$\milner{p}{q}{r}$ means $p \refinedby q; r$
\end{definition}

\begin{definition} [Test generation semantics]
$p[q]r$ means $p \refines q;r$
\end{definition}


\subsection*{Associativity and sequence rules}

\begin{law}[Assoc. of ;]
$p;(q;r) = (p;q);r$
\end{law}

\begin{rul}[Sequence rule for Hoare]
$\{p\}q\{s\}$ and $\{s\}q'\{r\}$ imply $\{p\}q;q'\{r\}$
\end{rul}

\begin{rul}[Sequence rule for Plotkin]
$\left\langle p, q \right\rangle \rightarrow s$ and $\left\langle s, q' \right\rangle \rightarrow r$ imply $\left\langle p, (q; q') \right\rangle \rightarrow r$
\end{rul}

\begin{rul}[Sequence rule for Milner]
$p - q \rightarrow s$ and $s - q' \rightarrow r$ imply $p - (q; q') \rightarrow r$
\end{rul}

\begin{rul}[Sequence rule for testgen]
$p [q] s$ and $s [q] r$ imply $p [q; q'] r$
\end{rul}

\begin{theorem}
Associativity law implies all sequence rules.
\end{theorem}

\begin{proof}
(for Hoare)\\
Let $\{p\}q\{s\}$ and $\{s\}q'\{r\}$.\\
According to the definition it means $p; q \refines s$ and $s; q' \refines r$\\
We are to prove that $p; (q; q') \refines r$\\
$p; (q; q') =^{assoc.} (p; q); q' \refines^{mon.} s; q' \refines r$\\
\\
(for Plotkin)\\
Let $\left\langle p, q \right\rangle \rightarrow s$ and $\left\langle s, q' \right\rangle \rightarrow r$.\\
According to the definition it means $s \refines p; q$ and $r \refines s; q'$\\
We are to prove that $r \refines p; (q; q')$\\
$r \refines s; q' \refines^{mon.} (p; q); q' =^{assoc.} p; (q; q')$\\
\\
(for Milner)\\
Let $p - q \rightarrow s$ and $s - q' \rightarrow r$\\
According to the definition it means $q; s \refines p; q$ and $q'; r \refines s$\\
We are to prove that $(q; q'); r \refines p$\\
$(q; q'); r =^{assoc.} q; (q'; r) \refines^{mon.} q; s \refines p$\\
\\
(for test)\\
Let $p [q] s$ and $s [q'] r$\\
According to the definition it means $p \refines q; s$ and $s \refines q'; r$\\
We are to prove that $p \refines (q; q'); r$\\
$p \refines q; s \refines^{mon.} q; (q'; r) =^{assoc.} (q; q'); r$
\end{proof}


\begin{theorem}
Sequence rules for Hoare + Plotkin or Milner + testgen imply associativity law.
\end{theorem}

\begin{proof}
Hoare + Plotkin.\\
Let $\{p\}q\{s\}$ and $\{s\}q'\{r\}$ imply $\{p\}q;q'\{r\}$\\
and\\
$\left\langle p, q \right\rangle \rightarrow s$ and $\left\langle s, q' \right\rangle \rightarrow r$ imply $\left\langle p, (q; q') \right\rangle \rightarrow r$\\
According to the definition it means\\
$p; q \refines s$ and $s; q' \refines r$ imply $p; (q; q') \refines r$\\
and\\
$s \refines p; q$ and $r \refines s; q'$ imply $r \refines p; (q; q')$\\
As $\refines$ is partial order then $p; q = s$ and $s; q' = r$\\
Also $p; (q; q') = r$.\\
$p; (q; q') = r = s; q' = (p; q); q'$.
\end{proof}

\subsection*{Skip}

\begin{law}[Skip]
$p;\eps = p = \eps;p$
\end{law}

\begin{rul}[Nullity for Hoare]
$\{p\}\eps\{p\}$
\end{rul}

Same for Plotkin, Milner, test.

\begin{theorem}
Skip law implies all nullity rules.
\end{theorem}

\begin{theorem}
Conjunction of all nullity rules implies skip law.
\end{theorem}


\subsection*{Distribution and nondeterminism}

\begin{definition}[$\sqcup$]
$p \sqcup q$ is smallest $r$ such that $p \refines r, q \refines r$.
\end{definition}

\begin{law}[Left distributivity]
$p; (q \sqcup q') = p;q \sqcup p;q'$
\end{law}

\begin{rul}[Nondeterminism for Hoare]
$\{p\}q\{r\}, \{p\}q'\{r\}$ imply $\{p\}q\sqcup q'\{r\}$
\end{rul}

\begin{rul}[Nondeterminism for Milner]
$\milner{p}{q}{r}, \milner{p}{q'}{r}$ imply $\milner{p}{q\sqcup q'}{r}$
\end{rul}

\begin{rul}[Nondeterminism for Plotkin]
$\plotkin{p}{q}{r}$ or $\plotkin{p}{q'}{r}$ implies $\plotkin{p}{q\sqcup q'}{r}$
\end{rul}

\begin{rul}[Nondeterminism for test]
$p [q] r$ or $p [q'] r$ implies $p [q;q'] r$
\end{rul}

\begin{theorem}
Left distributivity implies nondeterminism for all four formalisms.
\end{theorem}


\begin{theorem}
Nondeterminism rules for (Hoare or Milner) and (Plotkin or test) 
imply left distributivity.
\end{theorem}


\subsection*{Locality and frame rules}
Theorems seem trivial.

\subsection*{Separation logic}

\begin{axiom}[commutativity and associativity of $|$]
\end{axiom}

Do we need it?

\begin{law}[Exchange]
$(p|p');(q|q') \refines (p;q)|(p';q')$
\end{law}

\begin{rul}[Parallel for Hoare]
$\{p\}q\{r\}$ and $\{p'\}q'\{r'\}$ imply $\{p|p'\} q|q' \{r|r'\}$
\end{rul}

\begin{rul}[Parallel for Milner]
Likewise.
\end{rul}

\begin{theorem}
Exchange law implies parallel rules for Hoare and Milner.
\end{theorem}

\begin{theorem}
Parallel rules for Hoare and Milner imply exchange law.
\end{theorem}


\subsection*{Weakest preconditions}

\begin{definition}
$wp(q, r) = \textrm{largest } p$ such that $\{p\}q\{r\}$.
\end{definition}

\begin{law}[adjointness]
$p\refines wp(q, r)$ iff $p;q \refines r$
\end{law}

Do we need  definition (because it seems that law is enough)?

\begin{rul}[WP1]
$wp(q, r); q \refines r$
\end{rul}

\begin{rul}[WP2]
$p \refines wp(q, (p;q))$
\end{rul}

\begin{theorem}
Adjointness law implies WP1 and WP2.
\end{theorem}

\begin{theorem}
WP1 and WP2 imply adjointness law.
\end{theorem}


%% wp properties 

\begin{theorem}[wp monotonicity]
$q_1 \refines q, r \refines r'$ imply $wp(q, r) \refines wp(q_1, r')$
\end{theorem}

\begin{theorem}[stepwise wp]
$wp((q;q'), r) \refines wp(q, wp(q', r))$
\end{theorem}

\begin{theorem}
$wp(q, r) \refines wp((q;s), (r;s))$
\end{theorem}

\end{document}